# # Welcome to your prefect.yaml file! You can use this file for storing and managing
# # configuration for deploying your flows. We recommend committing this file to source
# # control along with your flow code.

# # Generic metadata about this project
# name: predictive_maintenance
# prefect-version: 3.6.9

# # build section allows you to manage and build docker images
# build: null

# # push section allows you to manage if and how this project is uploaded to remote locations
# push: null

# # pull section allows you to provide instructions for cloning this project in remote locations
# pull:
# - prefect.deployments.steps.set_working_directory:
#     directory: /Users/chidera/Projects/predictive_maintenance

# # the deployments section allows you to provide configuration for deploying flows
# deployments:
# - name: predictive-maintenance-local
#   version: null
#   tags: []
#   concurrency_limit: null
#   description: null
#   entrypoint: ./training/flows/main_flow.py:main_flow
#   parameters: {}
#   work_pool:
#     name: predictive-maintenance-pool
#     work_queue_name: null
#     job_variables: {}
#   schedules:
#   - cron: 0 0 * * *
#     timezone: UTC
#     day_or: true
#     active: false

name: predictive_maintenance
prefect-version: 3.6.9

# build section allows you to manage and build docker images
build: null

# push section allows you to manage if and how this project is uploaded to remote locations
push: null

# --- CRITICAL CHANGE 1: Clone from GitHub, don't look at local disk ---
pull:
  - prefect.deployments.steps.git_clone:
      repository: https://github.com/vic-comm/predictive_maintenance.git
      branch: master
      
deployments:
  - name: "predictive-maintenance-prod"
    version: null
    tags: ["production"]
    description: "Weekly training pipeline running on Prefect Cloud"
    entrypoint: "training/flows/main_flow.py:main_flow"
    
    work_pool:
      name: "predictive-maintenance-pool"
      work_queue_name: null
      job_variables:
        env:
          MLFLOW_TRACKING_USERNAME: "obiezuevictor"
          MLFLOW_TRACKING_URI: "https://dagshub.com/obiezuevictor/predictive_maintenance.mlflow"
        pip_packages:
          - dvc
          - dvc-s3 
          - s3fs
          - setuptools
          - prefect
          - mlflow
          - dagshub
          - scikit-learn
          - xgboost
          - pandas
          - numpy
          - boto3
          - python-dotenv
          - seaborn
          - matplotlib
          - category-encoders
          - hyperopt
    schedules:
      - cron: "0 8 * * 1" # Every Monday at 8 AM
        timezone: "UTC"
        active: true
